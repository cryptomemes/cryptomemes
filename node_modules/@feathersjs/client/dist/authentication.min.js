!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.feathers=t():e.feathers=t()}(this,function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,o){(function(n){function r(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=o(10)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+t.humanize(this.diff),o){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),e.splice(i,0,n)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=r,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(r())}).call(this,o(9))},function(e,t,o){"use strict";e.exports=o(2)},function(e,t,o){"use strict";var n=o(3),r=o(7),i={header:"Authorization",cookie:"feathers-jwt",storageKey:"feathers-jwt",jwtStrategy:"jwt",path:"/authentication",entity:"user",service:"users",timeout:5e3};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},i,e);return function(){var e=this;e.passport=new r(e,t),e.authenticate=e.passport.authenticate.bind(e.passport),e.logout=e.passport.logout.bind(e.passport),e.mixins.push(function(o){if(e.version<"3.0.0")throw new Error("This version of @feathersjs/authentication-client only works with @feathersjs/feathers v3.0.0 or later.");o.hooks({before:n.populateAccessToken(t)})}),e.rest&&e.mixins.push(function(e){e.hooks({before:n.populateHeader(t)})})}}e.exports=s,e.exports.default=s,e.exports.defaults=i},function(e,t,o){"use strict";var n={populateHeader:o(4),populateAccessToken:o(5),populateEntity:o(6)};e.exports=n},function(e,t,o){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.header)throw new Error("You need to pass 'options.header' to the populateHeader() hook.");return function(t){return"before"!==t.type?Promise.reject(new Error("The 'populateHeader' hook should only be used as a 'before' hook.")):(t.params.accessToken&&(t.params.headers=Object.assign({},((o={})[e.header]=e.prefix?e.prefix+" "+t.params.accessToken:t.params.accessToken,o),t.params.headers)),Promise.resolve(t));var o}}},function(e,t,o){"use strict";e.exports=function(){return function(e){var t=e.app;return"before"!==e.type?Promise.reject(new Error("The 'populateAccessToken' hook should only be used as a 'before' hook.")):(Object.assign(e.params,{accessToken:t.get("accessToken")}),Promise.resolve(e))}}},function(e,t,o){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.service)throw new Error("You need to pass 'options.service' to the populateEntity() hook.");if(!e.field)throw new Error("You need to pass 'options.field' to the populateEntity() hook.");if(!e.entity)throw new Error("You need to pass 'options.entity' to the populateEntity() hook.");return function(t){var o=t.app;return"after"!==t.type?Promise.reject(new Error("The 'populateEntity' hook should only be used as an 'after' hook.")):o.passport.verifyJWT(t.result.accessToken).then(function(t){var n=t[e.field];return n?o.service(e.service).get(n):Promise.reject(new Error("Access token payload is missing the '"+e.field+"' field."))}).then(function(n){return t.result[e.entity]=n,o.set(e.entity,n),Promise.resolve(t)})}}},function(e,t,o){"use strict";var n=o(8),r=o(12),i=o(0),s=o(15),a=s.Storage,c=s.payloadIsValid,u=s.getCookie,f=s.clearCookie,l=i("@feathersjs/authentication-client");e.exports=function(){function e(t,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.passport)throw new Error("You have already registered authentication on this client app instance. You only need to do it once.");Object.assign(this,{options:o,app:t,payloadIsValid:c,getCookie:u,clearCookie:f,storage:t.get("storage")||this.getStorage(o.storage)}),this.setJWT=this.setJWT.bind(this),t.set("storage",this.storage),this.getJWT().then(this.setJWT),this.setupSocketListeners()}return e.prototype.setupSocketListeners=function(){var e=this,t=this.app,o=t.io||t.primus,n=t.io?"emit":"send",r=t.io?"reconnect":"reconnected";if(o){o.on(r,function(){if(l("Socket reconnected"),o.authenticated){var r={strategy:e.options.jwtStrategy,accessToken:t.get("accessToken")};e.authenticateSocket(r,o,n).then(e.setJWT).catch(function(e){l("Error re-authenticating after socket reconnect",e),o.authenticated=!1,t.emit("reauthentication-error",e)})}});var i=function(){o.io.engine.on("upgrade",function(){if(l("Socket upgrading"),o.authenticated){var r={strategy:e.options.jwtStrategy,accessToken:t.get("accessToken")};e.authenticateSocket(r,o,n).then(e.setJWT).catch(function(e){l("Error re-authenticating after socket upgrade",e),o.authenticated=!1,t.emit("reauthentication-error",e)})}})};o.io&&o.io.engine?i():o.on("connect",i)}},e.prototype.connected=function(){var e=this,t=this.app;if(t.rest)return Promise.resolve();var o=t.io||t.primus;return o?t.io&&o.connected||t.primus&&3===o.readyState?(l("Socket already connected"),Promise.resolve(o)):new Promise(function(n,r){var i=t.primus?"open":"connect",s=t.io?"disconnect":"end",a=setTimeout(function(){l("Socket connection timed out"),r(new Error("Socket connection timed out"))},e.options.timeout);l("Waiting for socket connection");var c=function(){l("Socket disconnected before it could connect"),o.authenticated=!1};o.once(s,c),o.once(i,function(){l("Socket connected"),l("Removing "+s+" listener"),o.removeListener(s,c),clearTimeout(a),n(o)})}):Promise.reject(new Error("It looks like your client connection has not been configured."))},e.prototype.authenticate=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.app,r=Promise.resolve(t);return t.strategy||(t.accessToken?t.strategy=this.options.jwtStrategy:r=this.getJWT().then(function(t){return t?{strategy:e.options.jwtStrategy,accessToken:t}:Promise.reject(new n.NotAuthenticated("Could not find stored JWT and no authentication strategy was given"))})),r.then(function(t){return e.connected(o).then(function(n){if(o.rest)return o.service(e.options.path).create(t).then(e.setJWT);var r=o.io?"emit":"send";return e.authenticateSocket(t,n,r).then(e.setJWT)})}).then(function(e){return o.emit("authenticated",e),e})},e.prototype.authenticateSocket=function(e,t,o){var n=this;return new Promise(function(r,i){var s=setTimeout(function(){l("authenticateSocket timed out"),i(new Error("Authentication timed out"))},n.options.timeout);l("Attempting to authenticate socket"),t[o]("authenticate",e,function(e,o){if(e)return i(e);clearTimeout(s),t.authenticated=!0,l("Socket authenticated!"),r(o)})})},e.prototype.logoutSocket=function(e,t){var o=this;return new Promise(function(n,r){var i=setTimeout(function(){l("logoutSocket timed out"),r(new Error("Logout timed out"))},o.options.timeout);e[t]("logout",function(t){if(clearTimeout(i),e.authenticated=!1,t)return r(t);n()})})},e.prototype.logout=function(){var e=this,t=this.app;return t.set("accessToken",null),this.clearCookie(this.options.cookie),Promise.resolve(t.get("storage").removeItem(this.options.storageKey)).then(function(){if(t.io||t.primus){var o=t.io?"emit":"send",n=t.io?t.io:t.primus;return e.logoutSocket(n,o)}}).then(function(e){return t.emit("logout",e),e})},e.prototype.setJWT=function(e){var t=e&&e.accessToken?e.accessToken:e;return t&&(this.app.set("accessToken",t),this.app.get("storage").setItem(this.options.storageKey,t)),Promise.resolve(e)},e.prototype.getJWT=function(){var e=this,t=this.app;return new Promise(function(o,n){var i=t.get("accessToken");return i?o(i):Promise.resolve(e.storage.getItem(e.options.storageKey)).then(function(t){var n=t||e.getCookie(e.options.cookie);return n&&"null"!==n&&!e.payloadIsValid(r(n))&&(n=void 0),o(n)}).catch(n)})},e.prototype.verifyJWT=function(e){if("string"!=typeof e)return Promise.reject(new Error("Token provided to verifyJWT is missing or not a string"));try{var t=r(e);return this.payloadIsValid(t)?Promise.resolve(t):Promise.reject(new Error("Invalid token: expired"))}catch(e){return Promise.reject(new Error("Cannot decode malformed token."))}},e.prototype.getStorage=function(e){return e||new a},e}()},function(e,t,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=o(0)("@feathersjs/errors");function i(e,t,o,s,a){var c=void 0,u=void 0,f=void 0;(e=e||"Error")instanceof Error?(u=e.message||"Error",e.errors&&(c=e.errors)):"object"===(void 0===e?"undefined":n(e))?(u=e.message||"Error",a=e):u=e,a&&((f=JSON.parse(JSON.stringify(a))).errors?(c=f.errors,delete f.errors):a.errors&&(c=JSON.parse(JSON.stringify(a.errors)))),this.type="FeathersError",this.name=t,this.message=u,this.code=o,this.className=s,this.data=f,this.errors=c||{},r(this.name+"("+this.code+"): "+this.message),r(this.errors),Error.captureStackTrace?Error.captureStackTrace(this,i):this.stack=(new Error).stack}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function a(e,t){i.call(this,e,"BadRequest",400,"bad-request",t)}function c(e,t){i.call(this,e,"NotAuthenticated",401,"not-authenticated",t)}function u(e,t){i.call(this,e,"PaymentError",402,"payment-error",t)}function f(e,t){i.call(this,e,"Forbidden",403,"forbidden",t)}function l(e,t){i.call(this,e,"NotFound",404,"not-found",t)}function p(e,t){i.call(this,e,"MethodNotAllowed",405,"method-not-allowed",t)}function d(e,t){i.call(this,e,"NotAcceptable",406,"not-acceptable",t)}function h(e,t){i.call(this,e,"Timeout",408,"timeout",t)}function m(e,t){i.call(this,e,"Conflict",409,"conflict",t)}function g(e,t){i.call(this,e,"LengthRequired",411,"length-required",t)}function y(e,t){i.call(this,e,"Unprocessable",422,"unprocessable",t)}function v(e,t){i.call(this,e,"TooManyRequests",429,"too-many-requests",t)}function C(e,t){i.call(this,e,"GeneralError",500,"general-error",t)}function w(e,t){i.call(this,e,"NotImplemented",501,"not-implemented",t)}function b(e,t){i.call(this,e,"BadGateway",502,"bad-gateway",t)}function k(e,t){i.call(this,e,"Unavailable",503,"unavailable",t)}s(i,Error),Object.defineProperty(i.prototype,"toJSON",{value:function(){return{name:this.name,message:this.message,code:this.code,className:this.className,data:this.data,errors:this.errors}}}),s(a,i),s(c,i),s(u,i),s(f,i),s(l,i),s(p,i),s(d,i),s(h,i),s(m,i),s(g,i),s(y,i),s(v,i),s(C,i),s(w,i),s(b,i),s(k,i);var F={FeathersError:i,BadRequest:a,NotAuthenticated:c,PaymentError:u,Forbidden:f,NotFound:l,MethodNotAllowed:p,NotAcceptable:d,Timeout:h,Conflict:m,LengthRequired:g,Unprocessable:y,TooManyRequests:v,GeneralError:C,NotImplemented:w,BadGateway:b,Unavailable:k,400:a,401:c,402:u,403:f,404:l,405:p,406:d,408:h,409:m,411:g,422:y,429:v,500:C,501:w,502:b,503:k};e.exports=Object.assign({convert:function(e){if(!e)return e;var t=F[e.name],o=t?new t(e.message,e.data):new Error(e.message||e);return"object"===(void 0===e?"undefined":n(e))&&Object.assign(o,e),o}},F)},function(e,t){var o,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(o===setTimeout)return setTimeout(e,0);if((o===i||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:i}catch(e){o=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],f=!1,l=-1;function p(){f&&c&&(f=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!f){var e=a(p);f=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];u.push(new h(e,t)),1!==u.length||f||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,o){function n(e){var o;function n(){if(n.enabled){var e=n,r=+new Date,i=r-(o||r);e.diff=i,e.prev=o,e.curr=r,o=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(o,n){if("%%"===o)return o;c++;var r=t.formatters[n];if("function"==typeof r){var i=s[c];o=r.call(e,i),s.splice(c,1),c--}return o}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var o,n=0;for(o in e)n=(n<<5)-n+e.charCodeAt(o),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=r,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var o;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(o=0;o<r;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(o=0;o<t.instances.length;o++){var i=t.instances[o];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var o,n;for(o=0,n=t.skips.length;o<n;o++)if(t.skips[o].test(e))return!1;for(o=0,n=t.names.length;o<n;o++)if(t.names[o].test(e))return!0;return!1},t.humanize=o(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var o=1e3,n=6e4,r=36e5,i=24*r;function s(e,t,o){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+o:Math.ceil(e/t)+" "+o+"s"}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return t.long?function(e){return s(e,i,"day")||s(e,r,"hour")||s(e,n,"minute")||s(e,o,"second")||e+" ms"}(e):function(e){return e>=i?Math.round(e/i)+"d":e>=r?Math.round(e/r)+"h":e>=n?Math.round(e/n)+"m":e>=o?Math.round(e/o)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,o){"use strict";var n=o(13);function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var o=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[o]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},function(e,t,o){var n=o(14);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(n(t).replace(/(.)/g,function(e,t){var o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}catch(e){return n(t)}}},function(e,t){function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new o("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i=0,s=0,a="";r=t.charAt(s++);~r&&(n=i%4?64*n+r:r,i++%4)?a+=String.fromCharCode(255&n>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a}},function(e,t,o){"use strict";t.Storage=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store={}}return e.prototype.getItem=function(e){return this.store[e]},e.prototype.setItem=function(e,t){return this.store[e]=t},e.prototype.removeItem=function(e){return delete this.store[e],this},e}(),t.payloadIsValid=function(e){return e&&(!e.exp||1e3*e.exp>(new Date).getTime())},t.getCookie=function(e){if("undefined"!=typeof document){var t=("; "+document.cookie).split("; "+e+"=");if(2===t.length)return t.pop().split(";").shift()}return null},t.clearCookie=function(e){return"undefined"!=typeof document&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"),null}}])});